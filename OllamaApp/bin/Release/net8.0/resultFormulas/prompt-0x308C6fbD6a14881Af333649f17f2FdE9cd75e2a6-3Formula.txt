[assembly: FormulaAssembly("Initialize")]

namespace Sauron.Formula.Initialize

public class InitializeFormula : IFormulaPlugin
{
    public CalculationResult<IEnumerable<KeyValuePair<string, BigDecimal>>?> Formula(TransactionInfo info,
        IEnumerable<KeyValuePair<string, decimal>>? tokenPrices = null)
    {
        // Check if the sender is the factory
        var sender = info.FromAddress;
        var factory = info.ToAddress;
        if (sender != factory)
            return new CalculationResult<IEnumerable<KeyValuePair<string, BigDecimal>>?>(null);

        // Get the token addresses from transfers
        var tokens = info.GetDistinctTokens().Take(2).ToList();
        if (tokens.Count != 2)
            return new CalculationResult<IEnumerable<KeyValuePair<string, BigDecimal>>?>(null);

        // Calculate PNL as there is no direct profit or loss in initialization, so return empty result
        return new CalculationResult<IEnumerable<KeyValuePair<string, BigDecimal>>?>(new List<KeyValuePair<string, BigDecimal>>());
    }
}